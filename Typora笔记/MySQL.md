# MySQL

## 存储引擎

### 概念

不同的数据文件在物理磁盘上不同的组织形式

![image-20210322161138779](C:\Users\alienware\AppData\Roaming\Typora\typora-user-images\image-20210322161138779.png)

## 索引 

索引 是帮助MySQL高效获取数据的**排好序**的**数据结构**，对表中**一列**或**多列**的值进行排序的结构。类似一本字典的目录。

### 索引的缺点

- 降低了表的更新速度。MySQL不仅要保存数据，还要保存索引文件
- 索引文件会占用磁盘空间

### 索引分类

MySQL的InnoDB存储引擎下

- 聚集索引（聚簇索引）clustered index， primary key  主键索引
  - 叶子节点包含了完整的数据记录 （InnoDB ？）
  - 索引项和表中数据的排序方式一致。聚集索引的顺序就是数据的物理存储顺序
  - 一个表只能有一个聚集索引
  - InnoDB表必须要有整型自增的主键。若没有建主键，MySQL会从其他列中选出一个数据不重复的列当作索引列；若找不到数据不重复的列，则MySQL会使用row_id作为索引列
    - 主键为什么选用整型而不用uuid之类的
      - 聚集索引中，整型主键会作为默认索引和数据一起保存在idb文件中
      - innoDB存储结构为B+树，整型便于查询操作。
      - 整型相较于uuid，存储空间占用更小（uuid为一串32位16进制的字符串），MySQL中integer占用4byte=32bit，varchar边长字符串类型0~65535byte  1byte=8bit
- 非聚集索引（稀疏索引）
  - （MyISAM）索引数据和表数据分开存放
- 单列索引
- 组合索引
- 唯一索引 unique
- 普通索引 key
- 全文索引 FULLTEXT
- 空间索引 SPATIAL

按索引列的数量分

- 单列索引
- 组合索引 （联合索引，联合主键）



## 索引的数据结构

hash：数据放在内存中来创建表。

​			缺点：

- 浪费内存空间
- 适合等值查询，不适合范围查询
- hash冲突

二叉树：

缺点：

- 查询效率受限于树的深度，导致磁盘IO次数过多



关于树的一些概念：

- 节点的度：一个节点包含子节点的个数
- 树的度：树中最大节点的度 为树的度
- 深度：任意节点n，n的深度为从跟到n的唯一路径长
- 高度：任意节点n，n的高度为从n到一片树叶的最长路径长

Mysql数据结构是B+树

B树的几个概念

- 阶数：一个节点最多有多少个子节点，一般用m表示（理论上）
- 度：一个节点拥有的子节点的数量（已有的子节点）
- 关键字：节点上的数值

B+树特点

- 非叶子节点不存放数据，只存放索引（冗余），可以放更多的索引

- 叶子节点包含所有的索引字段

- 叶子节点用双向指针链接，提高区间访问的性能

  MyISAM存储引擎

  表的三种文件

  - .frm
    - frame的缩写，表示表的结构
  - MYD
    - MyISam Data  ，表数据的存储文件
  - MYI
    - MyIsam Index  表索引的存储文件

![image-20210322121634840](C:\Users\alienware\AppData\Roaming\Typora\typora-user-images\image-20210322121634840.png)



InnoDB存储引擎文件

- frm
  - frame  表结构存储文件
  - ibd      InnoDB database table , 就是 **表索引+ 表数据**的存储文件
    - ibd文件就是按照B+树组织的一个索引结构文件

![image-20210322121725393](C:\Users\alienware\AppData\Roaming\Typora\typora-user-images\image-20210322121725393.png)











回表

索引覆盖

索引下推 （MySQL5.6引入的功能）

最左匹配



自然主键 ： 事务属性中自然唯一的标识。如身份证号，手机号

代理主键 ： 与业务无关，无意义的数字序列值。如自增长id